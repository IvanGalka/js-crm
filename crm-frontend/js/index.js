const svgAddBtn = `
<svg width="23" height="16" viewbox="0 0 23 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.5 8C16.71 8 18.5 6.21 18.5 4C18.5 1.79 16.71 0 14.5 0C12.29 0 10.5 1.79 10.5 4C10.5 6.21 12.29 8 14.5 8ZM5.5 6V3H3.5V6H0.5V8H3.5V11H5.5V8H8.5V6H5.5ZM14.5 10C11.83 10 6.5 11.34 6.5 14V16H22.5V14C22.5 11.34 17.17 10 14.5 10Z" fill="#9873FF"/>
</svg>
`;

const svgAddContactBtnDefault = `
<svg width="14" height="14" viewbox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6.99998 3.66683C6.63331 3.66683 6.33331 3.96683 6.33331 4.3335V6.3335H4.33331C3.96665 6.3335 3.66665 6.6335 3.66665 7.00016C3.66665 7.36683 3.96665 7.66683 4.33331 7.66683H6.33331V9.66683C6.33331 10.0335 6.63331 10.3335 6.99998 10.3335C7.36665 10.3335 7.66665 10.0335 7.66665 9.66683V7.66683H9.66665C10.0333 7.66683 10.3333 7.36683 10.3333 7.00016C10.3333 6.6335 10.0333 6.3335 9.66665 6.3335H7.66665V4.3335C7.66665 3.96683 7.36665 3.66683 6.99998 3.66683ZM6.99998 0.333496C3.31998 0.333496 0.333313 3.32016 0.333313 7.00016C0.333313 10.6802 3.31998 13.6668 6.99998 13.6668C10.68 13.6668 13.6666 10.6802 13.6666 7.00016C13.6666 3.32016 10.68 0.333496 6.99998 0.333496ZM6.99998 12.3335C4.05998 12.3335 1.66665 9.94016 1.66665 7.00016C1.66665 4.06016 4.05998 1.66683 6.99998 1.66683C9.93998 1.66683 12.3333 4.06016 12.3333 7.00016C12.3333 9.94016 9.93998 12.3335 6.99998 12.3335Z" fill="#9873FF"/>
</svg>
`;

const svgAddContactBtnHover = `
<svg width="14" height="14" viewbox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M0.333313 7.00016C0.333313 3.32016 3.31998 0.333496 6.99998 0.333496C10.68 0.333496 13.6666 3.32016 13.6666 7.00016C13.6666 10.6802 10.68 13.6668 6.99998 13.6668C3.31998 13.6668 0.333313 10.6802 0.333313 7.00016ZM6.33329 4.33366C6.33329 3.96699 6.63329 3.66699 6.99996 3.66699C7.36663 3.66699 7.66663 3.96699 7.66663 4.33366V6.33366H9.66663C10.0333 6.33366 10.3333 6.63366 10.3333 7.00033C10.3333 7.36699 10.0333 7.66699 9.66663 7.66699H7.66663V9.66699C7.66663 10.0337 7.36663 10.3337 6.99996 10.3337C6.63329 10.3337 6.33329 10.0337 6.33329 9.66699V7.66699H4.33329C3.96663 7.66699 3.66663 7.36699 3.66663 7.00033C3.66663 6.63366 3.96663 6.33366 4.33329 6.33366H6.33329V4.33366Z" fill="#9873FF"/>
</svg>
`;

const svgclose = `
<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M16.2333 1.73333L15.2666 0.766664L8.49991 7.53336L1.73324 0.766696L0.766576 1.73336L7.53324 8.50003L0.766603 15.2667L1.73327 16.2333L8.49991 9.46669L15.2666 16.2334L16.2332 15.2667L9.46657 8.50003L16.2333 1.73333Z" fill="#B0B0B0"/>
</svg>`;

const svgDeleteContact = `
<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6 0C2.682 0 0 2.682 0 6C0 9.318 2.682 12 6 12C9.318 12 12 9.318 12 6C12 2.682 9.318 0 6 0ZM6 10.8C3.354 10.8 1.2 8.646 1.2 6C1.2 3.354 3.354 1.2 6 1.2C8.646 1.2 10.8 3.354 10.8 6C10.8 8.646 8.646 10.8 6 10.8ZM8.154 3L6 5.154L3.846 3L3 3.846L5.154 6L3 8.154L3.846 9L6 6.846L8.154 9L9 8.154L6.846 6L9 3.846L8.154 3Z" fill="#B0B0B0"/>
</svg>`;

const svgVK = `
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<g opacity="0.7">
<path d="M8 0C3.58187 0 0 3.58171 0 8C0 12.4183 3.58187 16 8 16C12.4181 16 16 12.4183 16 8C16 3.58171 12.4181 0 8 0ZM12.058 8.86523C12.4309 9.22942 12.8254 9.57217 13.1601 9.97402C13.3084 10.1518 13.4482 10.3356 13.5546 10.5423C13.7065 10.8371 13.5693 11.1604 13.3055 11.1779L11.6665 11.1776C11.2432 11.2126 10.9064 11.0419 10.6224 10.7525C10.3957 10.5219 10.1853 10.2755 9.96698 10.037C9.87777 9.93915 9.78382 9.847 9.67186 9.77449C9.44843 9.62914 9.2543 9.67366 9.1263 9.90707C8.99585 10.1446 8.96606 10.4078 8.95362 10.6721C8.93577 11.0586 8.81923 11.1596 8.43147 11.1777C7.60291 11.2165 6.81674 11.0908 6.08606 10.6731C5.44147 10.3047 4.94257 9.78463 4.50783 9.19587C3.66126 8.04812 3.01291 6.78842 2.43036 5.49254C2.29925 5.2007 2.39517 5.04454 2.71714 5.03849C3.25205 5.02817 3.78697 5.02948 4.32188 5.03799C4.53958 5.04143 4.68362 5.166 4.76726 5.37142C5.05633 6.08262 5.4107 6.75928 5.85477 7.38684C5.97312 7.55396 6.09391 7.72059 6.26594 7.83861C6.45582 7.9689 6.60051 7.92585 6.69005 7.71388C6.74734 7.57917 6.77205 7.43513 6.78449 7.29076C6.82705 6.79628 6.83212 6.30195 6.75847 5.80943C6.71263 5.50122 6.53929 5.30218 6.23206 5.24391C6.07558 5.21428 6.0985 5.15634 6.17461 5.06697C6.3067 4.91245 6.43045 4.81686 6.67777 4.81686L8.52951 4.81653C8.82136 4.87382 8.88683 5.00477 8.92644 5.29874L8.92808 7.35656C8.92464 7.47032 8.98521 7.80751 9.18948 7.88198C9.35317 7.936 9.4612 7.80473 9.55908 7.70111C10.0032 7.22987 10.3195 6.67368 10.6029 6.09801C10.7279 5.84413 10.8358 5.58142 10.9406 5.31822C11.0185 5.1236 11.1396 5.02785 11.3593 5.03112L13.1424 5.03325C13.195 5.03325 13.2483 5.03374 13.3004 5.04274C13.6009 5.09414 13.6832 5.22345 13.5903 5.5166C13.4439 5.97721 13.1596 6.36088 12.8817 6.74553C12.5838 7.15736 12.2661 7.55478 11.9711 7.96841C11.7001 8.34652 11.7215 8.53688 12.058 8.86523Z" fill="#9873FF"/>
</g>
</svg>`;

const svgFB = `
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<g opacity="0.7">
<path d="M7.99999 0C3.6 0 0 3.60643 0 8.04819C0 12.0643 2.928 15.3976 6.75199 16V10.3775H4.71999V8.04819H6.75199V6.27309C6.75199 4.25703 7.94399 3.14859 9.77599 3.14859C10.648 3.14859 11.56 3.30121 11.56 3.30121V5.28514H10.552C9.55999 5.28514 9.24799 5.90362 9.24799 6.53815V8.04819H11.472L11.112 10.3775H9.24799V16C11.1331 15.7011 12.8497 14.7354 14.0879 13.2772C15.3261 11.819 16.0043 9.96437 16 8.04819C16 3.60643 12.4 0 7.99999 0Z" fill="#9873FF"/>
</g>
</svg>`;

const svgPhone = `
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<g opacity="0.7">
<circle cx="8" cy="8" r="8" fill="#9873FF"/>
<path d="M11.56 9.50222C11.0133 9.50222 10.4844 9.41333 9.99111 9.25333C9.83556 9.2 9.66222 9.24 9.54222 9.36L8.84444 10.2356C7.58667 9.63556 6.40889 8.50222 5.78222 7.2L6.64889 6.46222C6.76889 6.33778 6.80444 6.16444 6.75556 6.00889C6.59111 5.51556 6.50667 4.98667 6.50667 4.44C6.50667 4.2 6.30667 4 6.06667 4H4.52889C4.28889 4 4 4.10667 4 4.44C4 8.56889 7.43556 12 11.56 12C11.8756 12 12 11.72 12 11.4756V9.94222C12 9.70222 11.8 9.50222 11.56 9.50222Z" fill="white"/>
</g>
</svg>`;

const svgEmail = `
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16ZM4 5.75C4 5.3375 4.36 5 4.8 5H11.2C11.64 5 12 5.3375 12 5.75V10.25C12 10.6625 11.64 11 11.2 11H4.8C4.36 11 4 10.6625 4 10.25V5.75ZM8.424 8.1275L11.04 6.59375C11.14 6.53375 11.2 6.4325 11.2 6.32375C11.2 6.0725 10.908 5.9225 10.68 6.05375L8 7.625L5.32 6.05375C5.092 5.9225 4.8 6.0725 4.8 6.32375C4.8 6.4325 4.86 6.53375 4.96 6.59375L7.576 8.1275C7.836 8.28125 8.164 8.28125 8.424 8.1275Z" fill="#9873FF"/>
</svg>`;

const svgOther = `
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16ZM3 8C3 5.24 5.24 3 8 3C10.76 3 13 5.24 13 8C13 10.76 10.76 13 8 13C5.24 13 3 10.76 3 8ZM9.5 6C9.5 5.17 8.83 4.5 8 4.5C7.17 4.5 6.5 5.17 6.5 6C6.5 6.83 7.17 7.5 8 7.5C8.83 7.5 9.5 6.83 9.5 6ZM5 9.99C5.645 10.96 6.75 11.6 8 11.6C9.25 11.6 10.355 10.96 11 9.99C10.985 8.995 8.995 8.45 8 8.45C7 8.45 5.015 8.995 5 9.99Z" fill="#9873FF"/>
</svg>`;

function createHTMLElement (tag, tagClass, tagText) {
  const elem = document.createElement(tag);
  elem.classList.add(tagClass);
  elem.textContent = tagText;
  return elem
}

function createHTMLINput (inputClass, placeholderInput, required, typeInput) {
  const input = document.createElement('input');
  input.classList.add(inputClass);
  input.placeholder = placeholderInput;
  input.type = typeInput;
  if (required === true) {
    input.required = true;
  };
  return input
}

//Создание header
const createHeader = () => {
  const header = createHTMLElement('header', 'header');
  const logo = createHTMLElement('a', 'header__logo');
  const logoImg = createHTMLElement('img', 'header__img');
  const formHeader = createHTMLElement('form', 'header__form');
  const inputSearch = createHTMLElement('input', 'header__search');
  logoImg.setAttribute('src', './img/Logo.svg');
  inputSearch.placeholder = 'Введите запрос';
  logo.append(logoImg);
  formHeader.append(inputSearch);
  header.append(logo, formHeader);
  document.body.append(header);
}

//Создание секции Клиенты
const createClients = () => {
  const section = createHTMLElement('section', 'clients');
  const main = createHTMLElement('main');
  const container = createHTMLElement('div', 'container');
  const mainTitle = createHTMLElement('h1', 'clients__title', 'Клиенты');
  container.append(mainTitle);
  section.append(container);
  main.append(section);
  document.body.append(main);
  container.append(createTable());
  const addClientBtn = createHTMLElement('button', 'clients__add-btn', 'Добавить клиента');
  const iconAddClientBtn = createHTMLElement('span', 'clients__add-icon');
  iconAddClientBtn.innerHTML = svgAddBtn;
  addClientBtn.append(iconAddClientBtn);
  container.append(addClientBtn);

  addClientBtn.addEventListener('click', () => {
    document.body.append(createClientNew())
  })
}

//Создание ячеек заголовка
function createTableCellTitle (title, text, arrow) {
  const headCell = createHTMLElement('th', 'head-row__' + title);
  headCell.classList.add('th-cell');
  const headSpan = createHTMLElement('span', 'th-cell__' + title, text);
  headSpan.classList.add('th-cell__text');
  headCell.append(headSpan);
  if (arrow === true) {
    const arrowCell = createHTMLElement('span', 'head-row__arrow');
    const arrowImg = createHTMLElement('img', 'head-row__arrow-img');
    arrowImg.setAttribute('src', './img/Arrow.svg');
    arrowCell.append(arrowImg);
    headCell.append(arrowCell);
  }
  headCell.addEventListener('click', () => {
    const arrowTarget = headCell.querySelector('.head-row__arrow-img');
    const textTarget = headCell.querySelector('.th-cell__text');
    if (arrowTarget.classList.contains('arrow-down')) {
      arrowTarget.classList.remove('arrow-down');
      textTarget.classList.remove('text-focus');
    } else {
      const arrowsArray = document.querySelectorAll('.head-row__arrow-img');
      const textsArray = document.querySelectorAll('.th-cell__text');
      for (const item of arrowsArray) {
        item.classList.remove('arrow-down');
      };
      for (const item of textsArray) {
        item.classList.remove('text-focus');
      };
      arrowTarget.classList.add('arrow-down');
      textTarget.classList.add('text-focus');
    };
  })
  return headCell
}

//Создание таблицы
const createTable = () => {
  const table = createHTMLElement('table', 'clients__table');
  table.classList.add('table');
  const sortingDisplay = createHTMLElement('thead', 'table__head');
  const headTableRow = createHTMLElement('tr', 'head-row');

  const headCellId = createTableCellTitle('id', 'ID', true);
  const headCellFullName = createTableCellTitle('name', 'Фамилия Имя Отчество', true);
  const headCellNameNote = createHTMLElement('span', 'th-cell__note', 'А-Я');
  headCellFullName.append(headCellNameNote);
  const headCellCreateTime = createTableCellTitle('create-time', 'Дата и время создания', true);
  const headCellLastPatch = createTableCellTitle('last-patch', 'Последние изменения', true);
  const headCellContacts = createTableCellTitle('contacts', 'Контакты', false);
  const headCellActions = createTableCellTitle('actions', 'Действия', false);

  headTableRow.append(headCellId, headCellFullName, headCellCreateTime, headCellLastPatch, headCellContacts, headCellActions);
  sortingDisplay.append(headTableRow);
  table.append(sortingDisplay);

  const tbody = createHTMLElement('tbody', 'table__tbody');
  table.append(tbody);

  return table
}
//Создание элемента тела таблицы
const createTableBodyElement = (data) => {
  const clientTR = createHTMLElement('tr', 'table__item');
  clientTR.id = data.id;
  const clientId = createHTMLElement('td', 'table__id', data.id.substr(0, 6));
  const clientFullName = createHTMLElement('td', 'table__full-name');
  const clientSurname = createHTMLElement('span', 'table__black', data.surname + ' ');
  clientSurname.classList.add('table__surname');
  const clientName = createHTMLElement('span', 'table__black', data.name + ' ');
  clientName.classList.add('table__name');
  const clientSecondName = createHTMLElement('span', 'table__black', data.lastName);
  clientSecondName.classList.add('table__second-name');
  const clientCreated = createHTMLElement('td', 'table__created');
  const clientCreatedDate = createHTMLElement('span', 'table__created-date', formateDate(data.createdAt));
  const clientCreatedTime = createHTMLElement('span', 'table__created-time', formateTime(data.createdAt));
  const clientChanged = createHTMLElement('td', 'table__changed');
  const clientChangedDate = createHTMLElement('span', 'table__changed-date', formateDate(data.updatedAt));
  const clientChangedTime = createHTMLElement('span', 'table__changed-time', formateTime(data.updatedAt));
  const clientContacts = createHTMLElement('td', 'table__contacts');
  const clientActions = createHTMLElement('td', 'table__actions');
  const clientActionsEdit = createHTMLElement('button', 'table__btn', 'Изменить');
  clientActionsEdit.classList.add('table__edit');
  const clientActionsDelete = createHTMLElement('button', 'table__btn', 'Удалить');
  clientActionsDelete.classList.add('table__delete');
  const deleteClient = createDeleteClientModal();
  const editClient = createEditClientModal(data);

  for (const contact of data.contacts) {
    createContactItemByType(contact.type, contact.value, clientContacts)
  };

  clientActionsDelete.addEventListener('click', () => {
    document.body.append(deleteClient.deleteModal);
    deleteById();
  });

  const deleteById = () => {
    deleteClient.deleteModalButton.addEventListener('click', () => {
      deleteClientOnServer(data.id);
      document.getElementById(data.id).remove();
    });
  };

  clientActionsEdit.addEventListener('click', () => {
    document.body.append(editClient.editModal);
  });

  clientFullName.append(clientSurname, clientName, clientSecondName);
  clientCreated.append(clientCreatedDate, clientCreatedTime);
  clientChanged.append(clientChangedDate, clientChangedTime);
  clientActions.append(clientActionsEdit, clientActionsDelete);
  clientTR.append(clientId, clientFullName, clientCreated, clientChanged, clientContacts, clientActions);

  return clientTR
}
//Создание формы модального окна
function createModalForm () {
  const modalTitle = createHTMLElement('h2', 'modal__title', 'Новый клиент');
  const modalClose = createHTMLElement('button', 'modal__close');
  modalClose.innerHTML = svgclose;
  const modalForm = createHTMLElement('form', 'modal__form');

  const labelSurname = createHTMLElement('label', 'modal__label', 'Фамилия');
  labelSurname.for = 'floatingSurname';
  const inputSurname = createHTMLINput('modal__input', 'Фамилия', true, 'text');
  inputSurname.id = 'floatingSurname';
  const requiredSurname = createHTMLElement('span', 'modal__required', '*');

  const labelName = createHTMLElement('label', 'modal__label', 'Имя');
  labelName.for = 'floatingName';
  const inputName = createHTMLINput('modal__input', 'Имя', true, 'text');
  inputName.id = 'floatingName';
  const requiredName = createHTMLElement('span', 'modal__required', '*');

  const labelSecondName = createHTMLElement('label', 'modal__label', 'Отчество');
  labelSecondName.for = 'floatingSecondName';
  const inputSecondName = createHTMLINput('modal__input', 'Отчество', false, 'text');
  inputSecondName.id = 'floatingSecondName';

  const contactsBlock = createHTMLElement('div', 'modal__contacts');
  const btnAddContact = createHTMLElement('button', 'modal__button-contact', 'Добавить контакт');
  btnAddContact.classList.add('btn-active');

  btnAddContact.addEventListener('mousemove', () => {
    iconBtnAddContactDefault.classList.remove('icon-active');
    iconBtnAddContactHover.classList.add('icon-active');
  });

  btnAddContact.addEventListener('mouseleave', () => {
    iconBtnAddContactHover.classList.remove('icon-active');
    iconBtnAddContactDefault.classList.add('icon-active');
  });

  btnAddContact.addEventListener('click', (e) => {
    e.preventDefault();
    const contactsItems = document.getElementsByClassName('contact');
    if (contactsItems.length < 9) {
      const contactItem = createContactItem();
      contactsBlock.prepend(contactItem.contact);
      contactsBlock.style.backgroundColor = 'var(--color-athens-gray)';
      if (contactsItems.length > 4) {
        document.querySelector('.modal').style.alignItems = 'start';
      } else {
        document.querySelector('.modal').style.alignItems = 'center';
      }
    } else {
      const contactItem = createContactItem();
      contactsBlock.prepend(contactItem.contact);
      btnAddContact.classList.remove('btn-active');
    }
  })

  const iconBtnAddContactDefault = createHTMLElement('span', 'modal__contact-icon');
  iconBtnAddContactDefault.classList.add('modal__icon-default', 'icon-active');
  iconBtnAddContactDefault.innerHTML = svgAddContactBtnDefault;

  const iconBtnAddContactHover = createHTMLElement('span', 'modal__contact-icon');
  iconBtnAddContactHover.classList.add('modal__icon-hover');
  iconBtnAddContactHover.innerHTML = svgAddContactBtnHover;

  const btnSaveContact = createHTMLElement('button', 'modal__button-save', 'Сохранить');
  const btnModalCancel = createHTMLElement('button', 'modal__button-cancel', 'Отмена');
  const formFloatingSurname =createHTMLElement('div', 'modal__floating');
  const formFloatingName =createHTMLElement('div', 'modal__floating');
  const formFloatingSecondName =createHTMLElement('div', 'modal__floating');

  labelName.append(requiredName);
  labelSurname.append(requiredSurname);
  formFloatingSurname.append(inputSurname, labelSurname);
  formFloatingName.append(inputName, labelName);
  formFloatingSecondName.append(inputSecondName, labelSecondName);
  btnAddContact.append(iconBtnAddContactDefault, iconBtnAddContactHover);
  contactsBlock.append(btnAddContact);
  modalForm.append(formFloatingSurname, formFloatingName, formFloatingSecondName, contactsBlock, btnSaveContact, btnModalCancel);

  return {
    modalForm,
    modalClose,
    modalTitle,
    btnModalCancel,
    inputSurname,
    inputName,
    inputSecondName,
    labelSurname,
    labelName,
    labelSecondName,
    contactsBlock,
    btnAddContact
  }
}
//Создание модального окна добавления нового клиента
function createClientNew () {
  const form = createModalForm();
  const modalWindow = createHTMLElement('div', 'modal');
  modalWindow.classList.add('site-modal', 'modal-active');
  const modalContent = createHTMLElement('div', 'modal__content');

  form.modalForm.classList.add('add-client');

  modalContent.append(form.modalClose, form.modalTitle, form.modalForm);
  modalWindow.append(modalContent);

  document.addEventListener('click', (e) => {
    if (e.target == modalWindow) {
      modalWindow.remove();
    };
  });

  form.modalClose.addEventListener('click', (e) => {
    e.preventDefault();
    modalWindow.remove();
  });

  form.modalForm.addEventListener('submit', () => {
    const contactTypes = document.querySelectorAll('.contact__name');
    const contactInputs = document.querySelectorAll('.contact__input');
    let contacts = [];
    let clientObj = {};
    for (let i = 0; i < contactTypes.length; i++) {
      contacts.push ({
        type: contactTypes[i].innerHTML,
        value: contactInputs[i].value
      });
    };
    clientObj.name = form.inputName.value;
    clientObj.surname = form.inputSurname.value;
    clientObj.lastName = form.inputSecondName.value;
    clientObj.contacts = contacts;
    console.log(clientObj);
    sendClientData(clientObj, 'POST');
  })

  return modalWindow
}
//Создание модального окна удаления клиента
const createDeleteClientModal = () => {
  const deleteModal = createHTMLElement('div', 'delete-modal');
  deleteModal.classList.add('modal');
  const deleteModalContent = createHTMLElement('div', 'delete-modal__content');
  deleteModalContent.classList.add('modal__content');
  const modalClose = createHTMLElement('button', 'modal__close');
  modalClose.innerHTML = svgclose;
  const deleteModalTitle = createHTMLElement('h2', 'modal__title', 'Удалить клиента');
  deleteModalTitle.classList.add('delete-modal__title');
  const deleteModalText = createHTMLElement('p', 'delete-modal__text', 'Вы действительно хотите удалить данного клиента?');
  const deleteModalButton = createHTMLElement('button', 'delete-modal__btn', 'Удалить');
  const deleteModalBack = createHTMLElement('button', 'modal__button-cancel', 'Отмена');

  deleteModalContent.append(modalClose, deleteModalTitle, deleteModalText, deleteModalButton, deleteModalBack);
  deleteModal.append(deleteModalContent);

  window.addEventListener('click', (e) => {
    if (e.target === deleteModal) {
      deleteModal.remove();
    };
  });

  deleteModalBack.addEventListener('click', () => {
    deleteModal.remove();
  });

  modalClose.addEventListener('click', () => {
    deleteModal.remove();
  });

  deleteModalButton.addEventListener('click', () => {
    deleteModal.remove();
  });

  return {
    deleteModal,
    deleteModalContent,
    deleteModalButton
  };
};
//Создание Модального окна изменения клиента
const createEditClientModal = (data) => {
  const editModal = createHTMLElement('div', 'modal');
  const editModalContent = createHTMLElement('div', 'modal__content');
  const editForm = createModalForm();
  const titleId = createHTMLElement('span', 'modal__id', 'ID: ' + data.id.substr(0, 6));
  editForm.modalTitle.textContent = 'Изменить данные';
  editForm.btnModalCancel.textContent = 'Удалить клиента';

  editForm.btnModalCancel.addEventListener('click', (e) => {
    e.preventDefault();
    const deleteClient = createDeleteClientModal();
    document.body.append(deleteClient.deleteModal);
    deleteClient.deleteModalButton.addEventListener('click', () => {
      deleteClientOnServer(data.id);
      document.getElementById(data.id).remove();
    });
  });

  editForm.modalClose.addEventListener('click', () => {
    editModal.remove();
  });
  document.addEventListener('click', (e) => {
    if (e.target == editModal) {
      editModal.remove();
    };
  });

  editForm.inputSurname.value = data.surname;
  editForm.inputName.value = data.name;
  editForm.inputSecondName.value = data.lastName;

  for (const contact of data.contacts) {
    const createContact = createContactItem();
    createContact.contactName.textContent = contact.type;
    createContact.contactInput.value = contact.value;
    editForm.contactsBlock.prepend(createContact.contact);
    editForm.contactsBlock.style.backgroundColor = 'var(--color-athens-gray)';
  }

  if (data.contacts.length === 10) {
    editForm.btnAddContact.classList.remove('btn-active');
  };

  editForm.modalForm.addEventListener('submit', () => {
    const contactsTypes = document.querySelectorAll('.contact__name');
    const contactsValues = document.querySelectorAll('.contact__input');
    let contacts = [];
    let client = {};
    for (let i = 0; i < contactsTypes.length; i++) {
      contacts.push({
        type: contactsTypes[i].innerHTML,
        value: contactsValues[i].value
      });
    };
    client.name = editForm.inputName.value;
    client.surname = editForm.inputSurname.value;
    client.lastName = editForm.inputSecondName.value;
    client.contacts = contacts;

    sendClientData(client, 'PATCH', data.id);
  });

  editForm.modalTitle.append(titleId);
  editModalContent.append(editForm.modalTitle, editForm.modalClose, editForm.modalForm);
  editModal.append(editModalContent);

  return {
    editModal,
    editModalContent
  };
};
//Создание контакта в модальном окне
function createContactItem () {
  const contact = createHTMLElement('div', 'contact');
  const contactType = createHTMLElement('div', 'contact__type');
  const contactName = createHTMLElement('button', 'contact__name', 'Телефон');
  const contactList = createHTMLElement('ul', 'contact__list');
  const contactPhone = createHTMLElement('li', 'contact__item', 'Телефон');
  const contactVk = createHTMLElement('li', 'contact__item', 'VK');
  const contactFB = createHTMLElement('li', 'contact__item', 'Facebook');
  const contactEmail = createHTMLElement('li', 'contact__item', 'Email');
  const contactOuther = createHTMLElement('li', 'contact__item', 'Другое');

  const contactInput = createHTMLINput('contact__input', 'Введите данные контакта', false, 'Text');

  const contactDelete = createHTMLElement('button', 'contact__delete');
  contactDelete.innerHTML = svgDeleteContact;

  const contactDeleteTooltip = createHTMLElement('span', 'contact__tooltip', 'Удалить контакт');
  contactDeleteTooltip.classList.add('site-tooltip');

  contactDelete.addEventListener('click', (e) => {
    e.preventDefault();
    contact.remove();
    document.querySelector('.modal__button-contact').classList.add('btn-active');
  });

  contactName.addEventListener('click', (e) => {
    e.preventDefault();
    contactList.classList.toggle('contact__list-active');
    contactName.classList.toggle('contact__list-active');
  });

  contactType.addEventListener('mouseleave', () => {
    contactList.classList.remove('contact__list-active');
    contactName.classList.remove('contact__list-active');
  })

  const setType = (type) => {
    type.addEventListener('click', () => {
      contactName.textContent = type.textContent;
      contactList.classList.remove('contact__list-active');
      contactName.classList.remove('contact__list-active');
    });
  };

  const typesArray = [contactPhone, contactEmail, contactVk, contactFB, contactOuther];
  for (const type of typesArray) {
    setType(type);
  }

  contactDelete.append(contactDeleteTooltip);
  contactList.append(contactPhone, contactEmail, contactVk, contactFB, contactOuther);
  contactType.append(contactName ,contactList);
  contact.append(contactType, contactInput, contactDelete);

  return {
    contact,
    contactName,
    contactInput,
    contactDelete
  }
}
//Создание ссылки контакта
const createContactLink = (type, value, element, svg, item) => {
  element = createHTMLElement('a', 'contacts__link');
  element.innerHTML = svg;
  if (type === 'Email') {
    element.href = `mailto:${value.trim()}`;
  } else if (type === 'Телефон') {
    element.href = `tel:${value.trim()}`;
  } else {
    element.href = value.trim();
  }
  const tooltip = createHTMLElement('a', 'contacts__link-tooltip', value);
  tooltip.classList.add('site-tooltip');
  element.append(tooltip);
  item.append(element);
}
//Создание ссылки контакта в зависимости от типа контакта
const createContactItemByType = (type, value, item) => {
  switch (type) {
    case 'Телефон':
      let phone;
      createContactLink(type, value, phone, svgPhone, item);
      break;
    case 'Facebook':
      let fb;
      createContactLink(type, value, fb, svgFB, item);
      break;
    case 'VK':
      let vk;
      createContactLink(type, value, vk, svgVK, item);
      break;
    case 'Email':
      let email;
      createContactLink(type, value, email, svgEmail, item);
      break;
    case 'Другое':
      let other;
      createContactLink(type, value, other, svgOther, item);
      break;
    default:
      break;
  }
}
// Сортировка таблицы
const getCellValue = (tr, idx) => tr.children[idx].innerText || tr.children[idx].textContent;

const comparer = (idx, asc) => (a, b) => ((v1, v2) =>
  v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2))(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));
//Фильтрация (поиск) таблицы
function tableSearch() {
  const phrase = document.querySelector('.header__search');
  const table = document.querySelector('table');
  const regPhrase = new RegExp(phrase.value, 'i');
  let flag = false;
  for (let i = 1; i < table.rows.length; i++) {
    flag = false;
    for (let j = table.rows[i].cells.length - 3; j >= 0; j--) {
      flag = regPhrase.test(table.rows[i].cells[j].textContent);
      if (flag) break;
    }
    if (flag) {
      table.rows[i].style.display = "";
    } else {
      table.rows[i].style.display = "none";
    }
  }
}
//Создание корректной даты
const formateDate = (date) => {
  const newDate = new Date(date);
  const correctDate = {
    year: 'numeric',
    month: 'numeric',
    day: 'numeric'
  };
  const resultDate = newDate.toLocaleString('ru', correctDate);
  return resultDate
}
//Создание корректного времени
const formateTime = (date) => {
  const newDate = new Date(date);
  const correctTime = {
    hour: 'numeric',
    minute: 'numeric',
  };
  const resultTime = newDate.toLocaleString('ru', correctTime);
  return resultTime
}
//Запрос на получение данных о клиенте
const getCliens = async (id) => {
  const response = await fetch('http://localhost:3000/api/clients', {
    method: 'GET'
    });
  const result = await response.json();
  console.log(result);
  return result
};
//Универсальный запрос, либо для создания нового клиента, либо для изменения данных о существующем
const sendClientData = async (client, method, id = null) => {
  try {
    await fetch(`http://localhost:3000/api/clients/${method === 'POST' ? '' : id}`, {
      method,
      body: JSON.stringify(client)
    });
  } catch (error) {
    console.log(error);
  };
};
//Запрос на удаление клиента
const deleteClientOnServer = async (id) => {
  const response = await fetch(`http://localhost:3000/api/clients/${id}`, {
    method: 'DELETE',
  });
};

document.addEventListener('DOMContentLoaded', async () => {
  //Создание основной разметки
  const clients = await getCliens();
  createHeader();
  createClients();
  //Создание строки в таблице для каждого клиента из базы
  for (const client of clients) {
    document.querySelector('tbody').append(createTableBodyElement(client))
  }
  //Событие сортировки
  document.querySelectorAll('th').forEach(th => th.addEventListener('click', (() => {
    const table = th.closest('table');
    const tbody = table.querySelector('tbody');
    Array.from(tbody.querySelectorAll('tr'))
      .sort(comparer(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc))
      .forEach(tr => tbody.appendChild(tr) );
  })));
  // Событие фильтрации
  const search = document.querySelector('.header__search');
  search.addEventListener('input', () => {
    setTimeout(tableSearch, 300);
  });
});
